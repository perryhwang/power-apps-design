# 审批状态跟踪界面设计

## 页面架构概览

### 主要功能区域
- **仪表板概览区**: 核心指标和趋势图表
- **状态筛选区**: 多维度筛选和搜索
- **申请列表区**: 详细申请信息展示
- **状态详情区**: 单个申请的完整跟踪信息
- **批量操作区**: 批量状态管理和导出

## 1. 仪表板概览区域

### 核心KPI卡片
```
控件布局: Container (网格布局 2x3)
属性配置:
- Width: Parent.Width
- Height: 200
- Fill: RGBA(248, 248, 248, 1)
- Padding: 20

KPI卡片设计:
卡片1 - 总申请数量:
- 数据源: CountRows(PermissionRequests)
- 显示: 大数字 + 环比变化
- 颜色: 蓝色主题

卡片2 - 待审批数量:
- 数据源: CountRows(Filter(PermissionRequests, Status = "待审批"))
- 显示: 数量 + 超时预警
- 颜色: 橙色主题

卡片3 - 今日处理数量:
- 数据源: CountRows(Filter(PermissionRequests, DateValue(Text(ReviewDate, "yyyy-mm-dd")) = Today()))
- 显示: 当日数量 + 处理速度
- 颜色: 绿色主题

卡片4 - 平均处理时间:
- 数据源: Average(处理时间计算)
- 显示: 小时数 + 趋势箭头
- 颜色: 紫色主题

卡片5 - 通过率:
- 数据源: 通过数量/总完成数量 * 100
- 显示: 百分比 + 对比上期
- 颜色: 青色主题

卡片6 - 超时率:
- 数据源: 超时数量/总数量 * 100
- 显示: 百分比 + 预警状态
- 颜色: 红色主题
```

### 趋势图表区域
```
控件类型: Container (水平布局)
包含图表:

1. StatusDistributionChart:
   - 类型: 饼图
   - 标题: "申请状态分布"
   - 数据: GroupBy(PermissionRequests, "Status", "Count")
   - 颜色方案: 状态对应色彩

2. ProcessingTrendChart:
   - 类型: 折线图
   - 标题: "审批处理趋势"
   - X轴: 日期
   - Y轴: 处理数量
   - 数据: 过去30天每日处理统计

3. ReviewerWorkloadChart:
   - 类型: 柱状图
   - 标题: "审核人工作量分布"
   - X轴: 审核人姓名
   - Y轴: 待处理申请数量
   - 排序: 按工作量降序
```

## 2. 高级筛选和搜索区域

### 搜索控件组
```
SearchContainer:
属性配置:
- Height: 80
- Fill: White
- BorderColor: RGBA(225, 223, 221, 1)
- Padding: 15

包含控件:
1. QuickSearchInput:
   - PlaceholderText: "搜索申请人、编号或权限系统..."
   - Width: 300
   - Icon: Search
   - OnChange: 实时筛选逻辑

2. AdvancedFilterButton:
   - Text: "高级筛选"
   - OnSelect: 展开高级筛选面板
   - Icon: Filter
```

### 高级筛选面板
```
AdvancedFilterPanel:
控件类型: Container (可折叠)
属性配置:
- Visible: varShowAdvancedFilter
- Height: 120
- Fill: RGBA(250, 249, 248, 1)

筛选条件:
1. DateRangeFilter:
   - StartDate: 开始日期选择器
   - EndDate: 结束日期选择器
   - QuickRanges: "今天", "本周", "本月", "本季度"

2. StatusMultiSelect:
   - Items: 所有状态选项
   - DefaultSelectedItems: 全部选中
   - DisplayMode: 复选框组

3. SystemFilter:
   - Items: Distinct(PermissionRequests, PermissionSystem)
   - AllowMultiple: true
   - DefaultText: "选择权限系统"

4. ReviewerFilter:
   - Items: Distinct(ApprovalTracking, ReviewerName)  
   - AllowMultiple: true
   - DefaultText: "选择审核人"

5. UrgencyFilter:
   - Items: ["全部", "普通", "紧急", "超时"]
   - Default: "全部"
```

### 筛选逻辑实现
```
Power Apps Formula:
Filter(
  PermissionRequests,
  (IsBlank(varSearchText) || 
   SearchColumns(Applicant & " " & RequestID & " " & PermissionSystem, varSearchText)) &&
  (varDateStart <= RequestDate && RequestDate <= varDateEnd) &&
  (CountRows(varSelectedStatuses) = 0 || Status in varSelectedStatuses) &&
  (CountRows(varSelectedSystems) = 0 || PermissionSystem in varSelectedSystems) &&
  (CountRows(varSelectedReviewers) = 0 || 
   RequestID in Distinct(Filter(ApprovalTracking, ReviewerName in varSelectedReviewers), RequestID))
)
```

## 3. 申请列表展示区域

### 数据表格设计
```
控件类型: Gallery (灵活高度)
属性配置:
- Items: varFilteredRequests
- TemplateSize: 100
- Width: Parent.Width - 40
- Height: Parent.Height - 400

表格列定义:
1. StatusColumn (80px):
   - StatusIndicator: 状态图标 + 颜色指示器
   - StatusText: 状态文本
   - 根据状态显示不同颜色和图标

2. RequestInfoColumn (200px):
   - RequestID: 申请编号 (可点击查看详情)
   - Applicant: 申请人姓名
   - RequestDate: 申请时间 (相对时间显示)

3. PermissionInfoColumn (250px):
   - PermissionSystem: 权限系统标签
   - PermissionObject: 权限对象 (文本截断)
   - Urgency: 紧急程度标记

4. ReviewerColumn (150px):
   - AssignedReviewers: 分配的审核人
   - ReviewProgress: 审批进度条
   - OverdueWarning: 超时警告图标

5. TimingColumn (120px):
   - ProcessingTime: 已处理时间
   - RemainingTime: 剩余时间 (如适用)
   - TimeStatus: 时间状态指示器

6. ActionsColumn (100px):
   - ViewDetailsButton: 查看详情
   - QuickActionsMenu: 快速操作菜单
   - MoreOptionsButton: 更多选项
```

### 行交互设计
```
行选中状态:
- OnSelect: Set(varSelectedRequest, ThisItem)
- Fill: 选中时高亮显示
- HoverFill: 鼠标悬停效果

行右键菜单:
- 查看详情
- 发送催办
- 修改优先级
- 添加备注
- 导出记录

批量选择:
- SelectCheckbox: 每行前的复选框
- SelectAllHeader: 表头全选复选框
- BulkActionBar: 批量操作工具栏
```

## 4. 详细状态跟踪面板

### 申请详情卡片
```
RequestDetailCard:
控件类型: Container
属性配置:
- Width: 400
- Height: Parent.Height - 120
- Visible: !IsBlank(varSelectedRequest)
- Fill: White
- BorderThickness: 1

内容分区:
1. HeaderSection:
   - RequestTitle: 申请编号 + 状态
   - ApplicantInfo: 申请人信息卡片
   - RequestTime: 申请时间戳

2. PermissionDetailsSection:
   - SystemBadge: 权限系统标签
   - ObjectDescription: 权限对象描述
   - ReasonText: 申请原因
   - DurationInfo: 预计使用期限

3. CurrentStatusSection:
   - StatusTimeline: 状态时间线
   - CurrentStage: 当前阶段高亮
   - NextSteps: 下一步操作提示
```

### 审批进度时间线
```
ApprovalTimeline:
控件类型: Container (垂直布局)

时间线项目设计:
TimelineItem Structure:
- TimelinePoint: 圆点状态指示器
- TimelineContent: 时间线内容区域
- TimelineLine: 连接线 (除最后一项)

时间线数据:
Items: Sort(
  AddColumns(
    ApprovalHistory,
    "TimelineIcon", 
    Switch(
      Action,
      "Submitted", Icon.Upload,
      "Assigned", Icon.People, 
      "InReview", Icon.View,
      "Approved", Icon.CheckMark,
      "Rejected", Icon.Cancel,
      Icon.Clock
    ),
    "TimelineColor",
    Switch(
      Action,
      "Approved", RGBA(40, 167, 69, 1),
      "Rejected", RGBA(220, 53, 69, 1),
      "InReview", RGBA(23, 162, 184, 1),
      RGBA(108, 117, 125, 1)
    )
  ),
  Timestamp,
  Descending
)

时间线项模板:
- Icon: ThisItem.TimelineIcon
- IconColor: ThisItem.TimelineColor
- Title: ThisItem.Action
- Subtitle: ThisItem.ActorName
- Time: RelativeTime(ThisItem.Timestamp)
- Description: ThisItem.Comments
```

### 审核人状态追踪
```
ReviewerStatusTracking:
控件类型: Gallery (水平布局)

数据源: 
Filter(ApprovalTracking, RequestID = varSelectedRequest.RequestID)

审核人卡片设计:
ReviewerCard:
- ReviewerAvatar: 审核人头像
- ReviewerName: 审核人姓名
- ReviewerStatus: 当前状态标签
- AssignedTime: 分配时间
- ResponseTime: 响应时间 (如已响应)
- Decision: 审批决定图标
- Comments: 审批意见预览

状态指示器:
- Pending: 橙色时钟图标
- InReview: 蓝色眼睛图标  
- Approved: 绿色对勾图标
- Rejected: 红色叉号图标
- Overdue: 红色警告图标
```

## 5. 批量操作和导出功能

### 批量操作工具栏
```
BulkOperationToolbar:
控件类型: Container
属性配置:
- Visible: CountRows(varSelectedRequests) > 0
- Height: 60
- Fill: RGBA(0, 120, 212, 0.1)
- BorderColor: RGBA(0, 120, 212, 1)

操作按钮:
1. BulkSendReminderButton:
   - Text: "发送催办 (" & CountRows(varSelectedRequests) & ")"
   - OnSelect: 批量发送催办邮件
   - Visible: 只对待审批状态可用

2. BulkExportButton:
   - Text: "导出选中"
   - OnSelect: 导出选中申请详情
   - Format: Excel格式

3. BulkUpdatePriorityButton:
   - Text: "设置优先级"  
   - OnSelect: 显示优先级设置面板

4. BulkAssignReviewerButton:
   - Text: "重新分配审核人"
   - OnSelect: 显示审核人选择面板
   - Visible: 仅管理员可见

5. ClearSelectionButton:
   - Text: "清除选择"
   - OnSelect: Set(varSelectedRequests, Blank())
```

### 导出功能设计
```
ExportConfiguration:
导出格式选项:
1. Excel详细报告:
   - 包含所有申请字段
   - 审批历史和意见
   - 处理时间统计
   - 格式化状态和时间

2. PDF状态报告:
   - 执行摘要
   - 状态分布图表
   - 关键指标
   - 异常情况汇总

3. CSV数据导出:
   - 纯数据格式
   - 适合进一步分析
   - 包含计算字段

导出Power Apps公式:
Export(
  AddColumns(
    varFilteredRequests,
    "ProcessingDays", DateDiff(RequestDate, Now(), Days),
    "StatusChinese", 
    Switch(
      Status,
      "Pending", "待审批",
      "Approved", "已通过", 
      "Rejected", "已拒绝",
      Status
    ),
    "ReviewerNames", 
    Concat(
      Filter(ApprovalTracking, RequestID = ThisRecord.RequestID),
      ReviewerName,
      ";"
    )
  ),
  "权限申请跟踪报告_" & Text(Now(), "yyyy-mm-dd"),
  ExportFormat.Excel
)
```

## 6. 实时更新和通知

### 数据自动刷新
```
AutoRefreshLogic:
实现方式: Timer控件

Timer Properties:
- Duration: 30000 (30秒)
- Repeat: true
- AutoStart: true
- OnTimerEnd: 
  Set(varLastRefresh, Now());
  Set(varFilteredRequests, 重新筛选逻辑);
  UpdateKPIMetrics()

条件刷新:
- 当前页面活跃时才刷新
- 用户交互时暂停自动刷新
- 后台数据变更时立即刷新
```

### 变更通知系统
```
ChangeNotification:
实现机制: SignalR集成 (如果可用) 或定时检查

通知类型:
1. 状态变更通知:
   - 申请状态从待审批变为已审批
   - 新申请分配给用户
   - 申请被取消或修改

2. 超时警告通知:
   - 申请即将超时 (提前2小时)
   - 申请已超时
   - 需要升级处理

3. 系统通知:
   - 大批量申请导入完成
   - 系统维护通知
   - 配置变更通知

通知显示:
- 顶部横幅通知
- 右侧通知面板
- 数据变更高亮显示
```

## 7. 响应式设计和移动优化

### 屏幕适配策略
```
ResponsiveDesign:
断点定义:
- Mobile: < 768px
- Tablet: 768px - 1024px  
- Desktop: > 1024px

布局调整:
Mobile:
- 单列布局
- 隐藏次要信息
- 简化操作菜单
- 触摸友好的按钮大小

Tablet:
- 两列布局
- 可折叠侧边栏
- 适中的信息密度
- 支持手势操作

Desktop:
- 三列布局
- 完整功能显示
- 鼠标悬停效果
- 键盘快捷键支持

响应式公式:
If(
  App.Width < 768,
  "Mobile",
  If(App.Width < 1024, "Tablet", "Desktop")
)
```

### 性能优化
```
PerformanceOptimization:
数据加载策略:
- 分页加载: 每页50条记录
- 虚拟滚动: 大列表性能优化
- 懒加载: 详情面板按需加载
- 缓存机制: 常用数据本地缓存

查询优化:
- 索引优化: 基于常用筛选字段
- 预聚合: KPI数据预计算
- 增量更新: 只更新变更数据
- 异步处理: 耗时操作后台执行

UI优化:
- 虚拟化列表: 大数据集渲染优化
- 防抖处理: 搜索输入延迟执行  
- 骨架屏: 数据加载过程占位
- 图片懒加载: 头像和图标按需加载
```

## 8. 用户体验增强

### 交互细节设计
```
UserExperienceEnhancements:
微交互:
- 状态变更动画
- 数据加载进度条
- 按钮点击反馈
- 卡片悬停效果

快捷操作:
- 双击查看详情
- 右键快捷菜单  
- 键盘快捷键
- 手势操作支持

视觉反馈:
- 成功操作绿色提示
- 错误操作红色警告
- 处理中状态指示器
- 数据变更高亮显示

帮助指导:
- 首次使用引导
- 功能提示气泡
- 操作帮助文档
- 常见问题解答
```

### 无障碍设计
```
AccessibilityFeatures:
键盘导航:
- Tab键焦点管理
- 回车键确认操作
- Esc键取消操作
- 方向键列表导航

屏幕阅读器支持:
- 语义化标签
- 替代文本描述
- 焦点提示音
- 状态变更播报

视觉辅助:
- 高对比度模式
- 字体大小调节
- 颜色盲友好色彩
- 焦点高亮显示

操作简化:
- 大按钮设计
- 明确的操作提示
- 简化的导航结构
- 容错性设计
```